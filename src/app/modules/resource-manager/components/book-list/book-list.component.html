<!--
  ~ Copyright 2020-2022 Aion Technology LLC
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div class="spinner-container" *ngIf="tableCache.isLoading$ | async">
  <mat-progress-spinner color="primary" mode="indeterminate" [diameter]="100" [strokeWidth]="10"></mat-progress-spinner>
</div>

<div class="bg">
  <div class="list-container mat-elevation-z2">

    <div class="header">
      <mat-form-field>
        <input matInput [(ngModel)]="tableCache.filterBinding" (keyup)="tableCache.applyFilter($event.target.value)" placeholder="Filter"/>
        <button mat-button *ngIf="tableCache.filter" matSuffix mat-icon-button (click)="tableCache.clearFilter()">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <table mat-table [dataSource]="tableCache.tableDataSource" matSort>

      <div *ngIf="userSession.isSysAdmin">
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox
              (change)="$event ? tableCache.masterToggle() : null"
              [checked]="tableCache.selection.hasValue() && tableCache.isAllSelected()"
              [indeterminate]="tableCache.selection.hasValue() && !tableCache.isAllSelected()"
            >
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox
              (click)="$event.stopPropagation()"
              (change)="$event ? tableCache.selection.toggle(row) : null"
              [checked]="tableCache.selection.isSelected(row)"
            >
            </mat-checkbox>
          </td>
        </ng-container>
      </div>

      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
        <td mat-cell *matCellDef="let book">
          <a (click)="routeWithBackButton(['/resourcemanager/books', book.id])">{{ book.title }}</a>
        </td>
      </ng-container>

      <ng-container matColumnDef="author">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Author</th>
        <td mat-cell *matCellDef="let book">{{ book.author }}</td>
      </ng-container>

      <ng-container matColumnDef="gradeLevel">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Reading Level</th>
        <td mat-cell *matCellDef="let book">{{ book.gradeLevel }}</td>
      </ng-container>

      <ng-container matColumnDef="location">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Location</th>
        <td mat-cell *matCellDef="let book">{{ book.displayLocation }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: columns" (click)="tableCache.selection.toggle(row)"></tr>
    </table>

    <table class="footer mat-elevation-z1">
      <tr>
        <td><ms-selection-count-display [selectionCount]="tableCache.selectionCount"></ms-selection-count-display></td>
        <td><mat-paginator #paginator [pageSize]="tableCache.pageSize" [pageSizeOptions]="[10, 20, 50]"></mat-paginator></td>
      </tr>
    </table>

  </div>
</div>
